{% from 'components/general.html' import customButton %}
{% from 'icons.html' import plus, exit, menu_bar_3, caret_down, circle_check, paypal, paymethod_card, cash, star %}


<!-- WALLET -->
{% macro walletTab(text, walletOption=none) %}

    <div class="flex-auto flex flex-col  rounded-lg bg-gray-200 p-4 gap-6 min-h-[200px]"  >
    
            <h4 class="text-sm">{{ text }}</h4>

        {% if current_user.has_role('driver') %}

            {% if walletOption.bank_name %}
                <p class="font-bold text-3xl">{{ walletOption.balance | format_currency }}</p>
                <p class="font-bold text-xl whitespace-break-spaces my-auto"> #{{ walletOption.account_number }}</p>
            {% else %}

                <p class="font-bold text-3xl">{{ 0 | format_currency }}</p>
                <p class="font-bold text-xl whitespace-break-spaces mt-auto">{{ _("Add the bank account where you want to receive payments.") }}</p>
                {{ customButton(_('Add a bank account'), icon_svg=plus(fill="#fff"), classes="rounded-full w-fit mt-auto", hx_props={
                    'hx-get':url_for('inter.account.add_bank'),
                    'hx-target':'#modal-bg',
                    'hx-swap':'outerHTML'

                }) }}
            {% endif %}

        {% endif %}
        

    </div>
    
{% endmacro %}


{% macro paymethodTab(paymethod) %}

    {% if paymethod.method== 'paypal' %}
        {% set bg = 'bg-blue-400 hover:bg-blue-600' %}
        {% set text = paymethod.email %}
        {% set icon = paypal(height='h-8', width='w-8') %}
    {% elif paymethod.method == 'cash' %}
        {% set bg = 'bg-green-400 hover:bg-green-400' %}  
        {% set text = ''  %}
        {% set  icon = cash(height='h-8', width='w-8') %}
    {% elif paymethod.method == 'card' %}     
        {% set bg = 'bg-slate-300 hover:bg-slate-400'  %} 
        {% set text =  'xxxx-xxxx-xxxx-' + paymethod.card_number[-4:]%}
        {% set icon = paymethod_card() %}
    {% endif %}

    <a {% if paymethod.method != "cash" %} href="{{ url_for('inter.account.handle_payment_method', paymethod=paymethod._id) }}" hx-target="#page-content" hx-select="#page-content" hx-swap="outerHTML"
    {% endif %} 
    class="flex-auto flex flex-col rounded-lg p-4 {{ bg }} lg min-h-[200px]">

        <div class="w-full flex justify-between">
            <span class="text-slate-100">{{ paymethod.method.title() }}</span>
            {{ icon }}
        </div>
        <div>
           <span class="text-white">{{ text }}</span>
           
        </div>
        {% if paymethod.is_starred %}
            <span class="mt-auto ml-auto">{{ star() }}</span>
           {% endif %}

    </a>
    
{% endmacro %}

{% macro walletNavbar() %}

<nav id="navbar" class="w-full col-span-full relative flex pt-6 pb-2 px-6 sm:px-16 justify-between bg-white border-b-4 border-gray-300">

    <div id="left-nav" class="flex gap-x-2 items-center">
        <span class="lg:hidden">{{ menu_bar_3(fill="#000000") }}</span>
        <span>Uber Wallet</span>
    </div>

    <div id="right-nav" class="flex gap-x-6 items-center">

        <div id="wallet-info" class="hidden lg:flex items-center gap-x-2 relative h-full ">
            
            {% if current_user.profile_pic %}
                {% set img = url_for('profile_upload', filename=current_user.build_path('profile', 'profile.png'))  %}
            {% else %}
                {% set img =  url_for('static', filename='assets/default-user.jpeg')  %}
            {% endif %}

            <img src="{{ img }}"  class="rounded-full object-cover h-10 w-10"/>
            <span>{{ caret_down() }}</span>


            <div id="wallet-dropdown" class="absolute top-[100%] right-0 invisible overflow-hidden pt-3 z-10 shadow-lg rounded-md bg-transparent">
                <div class="flex flex-col gap-y-2 min-w-[200px] bg-white z-20 justify-center rounded-md [&>*:first-child]:rounded-t-md [&>*:last-child]:rounded-b-md " >
                    <a href="{{ url_for('inter.account.manage') }}" class="flex gap-x-6 py-3 px-4  hover:cursor-pointer broder-b border-b-gray-200">
                        <div class="rounded-full"> {{current_user.fname[0] + ' ' + current_user.lname[0] }} </div>
                    {{current_user.display_name()}}
                    </a>
                    <button hx-delete="{{ url_for('inter.auth.logout') }}" class="flex items-center gap-x-6 py-3 px-4 hover:cursor-pointer"><span>{{ exit() }}</span>{{ _("Sign Out") }}</a>
                </div>
            </div>
        </div>

        <script>
            linkHoverShow(document.querySelector("#wallet-info"), document.querySelector('#wallet-dropdown'))
        </script>
    </div>
</nav>  
    
{% endmacro %}


<!-- MANAGE ACCOUNT -->

{% macro manageNavbar() %}
    <nav id="navbar" class="w-full col-span-full relative flex pt-6 pb-2 px-6 md:px-16 justify-between bg-white md:bg-black">

        <div id="left-nav" class="flex gap-x-2 items-center font-medium text-black md:text-white">
            <a href="{{ url_for('inter.account.manage') }}" hx-target="#page-content" hx-select="#page-content" hx-swap="outerHTML">Uber Account</a>
        </div>
        
    </nav>     
{% endmacro %}

{% macro manageSubnavTab(text, url, local=true) %}

    {# local to mean on same page #}
    <a 
    href="{{ url_for(url) }}"
    {% if local %}
        hx-swap="multi:#subnav-content,#subnav" hx-select="#subnav-content,#subnav"
    {% endif %}
    class="py-4 px-2 md:pl-4  hover:bg-gray-200 gap-x-2 items-center">
         {{ text }}
    </a>
    
{% endmacro %}

{% macro manageAction(header, value, predicate, default, url_field) %}

    <a href="{{ url_for('inter.account.update', resource=url_field ) }}" hx-target="#page-content" hx-select="#page-content" class="cursor-pointer flex justify-between items-center">
        <div>
            <h4 class="font-medium">{{ header }}</h4>
            <p class="text-slate-400 flex gap-2 items-center">
                <span class="">{{ value or default }}</span>
                {% if predicate %}
                    {{ circle_check() }}
                {% endif %}

            </p>  
        </div> 
        {{ caret_down(classes="-rotate-90 text-slate-400")}}
    </a>
    
{% endmacro %}


{% macro tripTab(ride_data, ride_type) %}

    <a 
    href="{{ url_for('inter.account.trip_details', ride_id=ride_data._id) }}"
    class="flex gap-4 w-full border-2 border-gray-300 p-4 rounded-lg">
        <img src="{{ url_for('static', filename='assets/ride-options/' + ride_data.image) }}" class="h-[124px]" style="
                overflow-clip-margin: content-box;
                overflow: clip;
            ">
        <div class="flex flex-col gap-y-2">
            <p class="font-bold">{{  ride_data.dropoff_data.display_name[:60] }}{% if ride_data.dropoff_data.display_name | length > 60  %}...{% endif %}</p>
            
            <p>{{ ride_data.accepted_at | format_datetime(format='MMM dd, HH:mm')}}</p>

            {% if ride_type == 'rider' %}
                <p class="font-bold">{{ ride_data.rider_price | format_currency }}</>
            {% else %}
                <p class="font-bold">{{ ride_data.driver_price | format_currency }}</span>
            {% endif %}
                
        </div>
    </a>
    
{% endmacro %}